name: deploy-reactorcide-k8s
image: containers.catalystsquad.com/public/reactorcide/runnerbase:dev
source:
  type: git
  url: https://github.com/catalystcommunity/reactorcide.git
  ref: main
command: runnerlib run --job-command "python /job/src/jobs/scripts/deploy_k8s.py"
environment:
    # Required - Kubernetes access (raw kubeconfig YAML content)
    KUBECONFIG_CONTENT: "${secret:reactorcide/k8s:kubeconfig}"

    # Namespace and release
    REACTORCIDE_K8S_NAMESPACE: "${env:REACTORCIDE_K8S_NAMESPACE}"
    REACTORCIDE_HELM_RELEASE: "${env:REACTORCIDE_HELM_RELEASE}"

    # Database - provide URI or set PROVISION_POSTGRES=true
    # Zalando postgres defaults: team=reactorcide, version=16, size=5Gi, instances=1
    REACTORCIDE_DB_URI: "${env:REACTORCIDE_DB_URI}"
    REACTORCIDE_PROVISION_POSTGRES: "${env:REACTORCIDE_PROVISION_POSTGRES}"

    # Inline helm values (YAML content)
    REACTORCIDE_HELM_VALUES: "${env:REACTORCIDE_HELM_VALUES}"

    # Image tag
    REACTORCIDE_IMAGE_TAG: "${env:REACTORCIDE_IMAGE_TAG}"

    # Corndogs - deploy into namespace or provide external URL
    REACTORCIDE_DEPLOY_CORNDOGS: "${env:REACTORCIDE_DEPLOY_CORNDOGS}"
    REACTORCIDE_CORNDOGS_URL: "${env:REACTORCIDE_CORNDOGS_URL}"
    REACTORCIDE_CORNDOGS_DB_HOST: "${env:REACTORCIDE_CORNDOGS_DB_HOST}"
    REACTORCIDE_CORNDOGS_DB_NAME: "${env:REACTORCIDE_CORNDOGS_DB_NAME}"
    REACTORCIDE_CORNDOGS_DB_USER: "${env:REACTORCIDE_CORNDOGS_DB_USER}"
    REACTORCIDE_CORNDOGS_DB_PASSWORD: "${env:REACTORCIDE_CORNDOGS_DB_PASSWORD}"

    # Object storage - defaults to seaweedfs
    REACTORCIDE_OBJECT_STORE_TYPE: "${env:REACTORCIDE_OBJECT_STORE_TYPE}"
    REACTORCIDE_S3_ENDPOINT: "${env:REACTORCIDE_S3_ENDPOINT}"
    REACTORCIDE_S3_BUCKET: "${env:REACTORCIDE_S3_BUCKET}"
    REACTORCIDE_S3_REGION: "${env:REACTORCIDE_S3_REGION}"
    REACTORCIDE_S3_ACCESS_KEY: "${secret:reactorcide/k8s:s3_access_key}"
    REACTORCIDE_S3_SECRET_KEY: "${secret:reactorcide/k8s:s3_secret_key}"

    # GCS alternative
    REACTORCIDE_GCS_BUCKET: "${env:REACTORCIDE_GCS_BUCKET}"
    GOOGLE_APPLICATION_CREDENTIALS_JSON: "${env:GOOGLE_APPLICATION_CREDENTIALS_JSON}"

    # Gateway API HTTPRoutes
    REACTORCIDE_GATEWAY_ENABLED: "${env:REACTORCIDE_GATEWAY_ENABLED}"
    REACTORCIDE_GATEWAY_DOMAINS: "${env:REACTORCIDE_GATEWAY_DOMAINS}"
    REACTORCIDE_GATEWAY_NAME: "${env:REACTORCIDE_GATEWAY_NAME}"
    REACTORCIDE_GATEWAY_NAMESPACE: "${env:REACTORCIDE_GATEWAY_NAMESPACE}"
    REACTORCIDE_GATEWAY_SECTION: "${env:REACTORCIDE_GATEWAY_SECTION}"

    # Default user ID
    REACTORCIDE_DEFAULT_USER_ID: "${env:REACTORCIDE_DEFAULT_USER_ID}"
